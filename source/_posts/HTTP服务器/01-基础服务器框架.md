---
title: 01_基础服务器框架
date: 2025-09-21 01:16:22
tags:
categories: HTTP服务器
---
# 基础服务器框架
## 1 创建TCP服务器监听端口
```cpp
// HttpServer.cpp
void HttpServer::Impl::start() {
    server_fd_ = socket(AF_INET, SOCK_STREAM, 0);
    if (server_fd_ < 0) {
        perror("socket creation failed");
        return;
    }

    int opt = 1;
    if (setsockopt(server_fd_, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt))) {
        perror("setsockopt failed");
        return;
    }

    sockaddr_in address{};
    address.sin_family = AF_INET;
    address.sin_addr.s_addr = INADDR_ANY;
    address.sin_port = htons(port_);

    if (bind(server_fd_, (sockaddr *)&address, sizeof(address)) < 0) {
        perror("bind failed");
        return;
    }

    if (listen(server_fd_, 10) < 0) {
        perror("listen failed");
        return;
    }
    SPDLOG_INFO("HTTP server running on port {}", port_);
    return;
}
```
1. 创建一个socket，表明要进行互联网的TCP-IPv4通信
2. SO_REUSEADDR，服务器重启时可以立即复用当前端口，避免WAIT_TIME状态导致服务器起不来
3. 设置地址，使用ipv4，绑定所有网卡
4. bind(): 将socket与具体地址/端口关联
5. listen(): socket开始接受连接请求，创建一个长度为10的等待队列

## 2 实现请求接收循环
